generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  COMPLETED
  FAILED
  REFUND
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

enum PromoDiscountType {
  FLAT
  PERCENTAGE
}

enum PromoAppliesTo {
  ALL_USERS
  SPECIFIC_USERS
}

enum ReviewStatusBlog {
  pending
  approved
  rejected
}

enum AdjustmentType {
  SHIPPING
  NETWORK_FEE
  ITEM_ADD
  ITEM_REMOVE
  ITEM_SHIPPING
  DISCOUNT
  PENALTY
  TAX
  MANUAL
}

enum AdjustmentImpact {
  DEBIT
  CREDIT
}

enum AdjustmentStatus {
  PENDING
  PAID
  APPLIED
  CANCELLED
}


model User {
  id                Int      @id @default(autoincrement())
  name              String
  email             String   @unique
  profileImage      String?
  password          String?
  role              String   @default("USER")
  gender            Gender?
  phone             String?
  address           String?
  country           String?
  city              String?
  pincode           String?
  state             String?
  carts             Cart[]
  addresses         Address[]
  orders            Orders[] 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @default(now()) @updatedAt
  provider          String  @default("LOCAL")
}

model Header {
  id        Int      @id @default(autoincrement())
  name      String
  active    Boolean  @default(true)
  deleted   Int      @default(0) // 0 = not deleted, 1 = deleted
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id            Int           @id @default(autoincrement())
  name          String
  image         String?
  active        Boolean       @default(true)
  platform      String[]      @default([])  // ["xpress", "website"]
  deleted       Int           @default(0) // 0 = not deleted, 1 = deleted
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  subcategories Subcategory[]
  products  Product[]
  countryTaxes CountryTax[] 
  states        State[]       @relation("CategoryStates")
  hsn           String?
}

model Subcategory {
  id         Int      @id @default(autoincrement())
  name       String
  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id])
  image      String?
  active     Boolean  @default(true)
  platform      String[]      @default([])  // ["xpress", "website"]
  products   Product[]
  offerId     Int?      
  deleted    Int      @default(0) // 0 = not deleted, 1 = deleted
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  states        State[]       @relation("SubcategoryStates")
}

model Product {
  id              String      @id @default(cuid())
  name            String
  short           String?
  categoryId      Int?
  category        Category?   @relation(fields: [categoryId], references: [id])
  subcategoryId   Int
  subcategory     Subcategory? @relation(fields: [subcategoryId], references: [id])
  sku             String      @unique       // Unique SKU
  image           String[]
  description     String?
  active          Boolean     @default(true)
  deleted         Int         @default(0)
  slug            String?     @unique       // SEO-friendly URL
  metaTitle       String?     // SEO title
  metaDescription String?     // SEO description
  keywords        String?     // Optional keywords for SEO
  price           String?     // store as string
  stock           String?     // store as string
  size            String[]    @default([])  // array, default empty
  color           String[]    @default([])  // array, default empty
  otherCountriesPrice String?
  offerId         Int?        
  primaryOffer  Offer? @relation("PrimaryOffer", fields: [offerId], references: [id]) 
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  isDefault       Json?
  variations      ProductVariation[]
  offers          Offer[] @relation("ProductOffers")
  tags            Tag[]       @relation("ProductTags") 
  marketLinks MarketLink[] 
  minQuantity     String?   
  bulkPrice       String?  
  barCode            String?
  MRP             String?      // Add MRP
  platform      String[]      @default([])  // ["xpress", "website"]
  dimension       Json?
}

model ProductVariation {
  id          String   @id @default(cuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  variationName String
  sku         String   @unique
  price       String?
  otherCountriesPrice String?
  stock       String?
  short       String?
  image       String[]
  name       String?
  description String?
  offerId       Int?
  offer         Offer?   @relation("OfferToVariation", fields: [offerId], references: [id])
  active          Boolean     @default(true)
  deleted         Int         @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tags        Tag[]    @relation("VariationTags")
  minQuantity     String?   
  bulkPrice       String?
  barCode            String?
  MRP              String?
  dimension   Json?
}


model Attribute {
  id        Int      @id @default(autoincrement())
  name      String
  values    String[] // array of strings
  active    Boolean  @default(true)
  deleted   Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Offer {
  id            Int      @id @default(autoincrement())
  name          String
  discountType  String   
  discountValue Json     
  type          Json     
  description   String?
  active        Boolean  @default(true)
  deleted       Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  products          Product[] @relation("ProductOffers") 
  primaryProducts Product[] @relation("PrimaryOffer") 
  productVariations ProductVariation[]  @relation("OfferToVariation")
}

model CountryPricing {
  id        Int      @id @default(autoincrement())
  country   String
  code      String   @unique // e.g., "IN", "US"
  multiplier Float
  currency  String
  currencySymbol String?
  conversionRate Float?
  active    Boolean  @default(true)
  deleted   Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cart {
  id            String   @id @default(uuid())
  productId     String
  variationId   String?     // optional
  productName   String
  quantity      Int
  pricePerItem  Float
  bulkPrice       Float?      
  bulkMinQty      Int?        
  offerApplied    Boolean?      @default(false) 
  productOfferApplied Boolean?  @default(false) 
  productOfferDiscount Float?   
  productOffer       Json?
  productOfferId  Int?
  currency      String?
  currencySymbol String
  totalPrice    Float
  attributes    Json      
  userId        Int?
  user          User?     @relation(fields: [userId], references: [id])    
  image         String?
  is_buy         Boolean?   @default(false)
  selectedCountry String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  barCode       String?
  purchasePlatform    String?   @default("website")
}

model Address {
  id        String   @id @default(cuid())
  name      String
  mobile    String
  pincode   String
  address   String
  city      String
  state     String
  country   String?
  landmark  String?
  type      String   // Home | Office | Other
  customType String?
  isDefault   Boolean  @default(false)
  userId    Int?
  user      User?     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Tag {
  id        Int      @id @default(autoincrement())
  name      String
  active    Boolean  @default(true)
  image     String?
  deleted   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products  Product[] @relation("ProductTags")
  variations ProductVariation[] @relation("VariationTags")
}

model MarketLink {
  id          String   @id @default(cuid())
  countryName String
  countryCode String
  name        String
  url         String
  deleted     Boolean  @default(false)
  productId   String?  // optional abhi
  product     Product? @relation(fields: [productId], references: [id])  // optional
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model CountryTax {
  id         Int       @id @default(autoincrement())
  country    String
  countryCode String?
  categoryId Int
  category   Category  @relation(fields: [categoryId], references: [id])
  generalTax Float?
  gstTax     Float?
  type       String?
  active     Boolean   @default(true)
  deleted    Int       @default(0)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model VideoStory {
  id        Int      @id @default(autoincrement())
  title     String
  url       String
  active    Boolean  @default(true)
  deleted   Int      @default(0) // soft delete flag
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ContactMessage {
  id            Int      @id @default(autoincrement())
  name          String
  email         String
  platform      String   @default("website")
  message       String

  isRegistered  Boolean  @default(false)

  readByAdmin   Boolean  @default(false)
  readByUser    Boolean  @default(true)

  isDeleted     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  replies       MessageReply[]
}


model MessageReply {
  id               Int      @id @default(autoincrement())
  contactMessageId Int
  contactMessage   ContactMessage @relation(fields: [contactMessageId], references: [id])

  sender           String   // "admin" | "user"
  message          String

  readByAdmin      Boolean  @default(false)
  readByUser       Boolean  @default(false)

  createdAt        DateTime @default(now())
}





model Orders {
  id             Int      @id @default(autoincrement())
  orderNumber    String?  @unique
  userId         Int?     
  user           User?    @relation(fields: [userId], references: [id])
  
  shippingName    String?
  shippingPhone   String?
  shippingAddress String?
  shippingCity    String?
  shippingState   String?
  shippingPincode String?

  billingName    String?
  billingPhone   String?
  billingAddress String?
  billingCity    String?
  billingState   String?
  billingPincode String?

  items           Json      
  subtotal        Float?
  shippingCharges Float?
  taxAmount       Float?    
  discountAmount  Float?    
  totalAmount     Float?
  paymentMethod   String?
  paymentCurrency String?
  status          OrderStatus   @default(PENDING)  
  paymentStatus   PaymentStatus @default(PENDING)  
  promoCode           String?
  donationAmount      Float? 
  donationCampaignId  Int? 
  note                String? 

  active          Boolean  @default(true)
  deleted         Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  orderBy         String? 

  trackingLink     String? 
  invoiceNumber String? @unique
  invoiceDate   DateTime?

  adjustments order_adjustments[]
}

model ShippingPricing {
  id             String   @id @default(uuid())
  name           String
  price          Float
  description    String?
  active         Boolean  @default(true)
  deleted        Int      @default(0)
  country        String?  // Country name
  code           String?  // Country code (e.g., USA â†’ US)
  currency       String?  // Currency code (e.g., USD)
  currencySymbol String?  // Currency symbol (e.g., $)
  type           String?  // "Road" or "Air"
  createdAt      DateTime @default(now())
}

model State {
  id        Int      @id @default(autoincrement())
  name      String
  active    Boolean  @default(true)
  deleted   Int      @default(0)
  createdAt DateTime @default(now())
  categories Category[] @relation("CategoryStates")
  subcategories Subcategory[]  @relation("SubcategoryStates")
  banners BannerState[]
}

model WareHouse {
  id        Int      @id @default(autoincrement())
  state     String
  name      String
  address   String
  contact   String?
  code      String
  pincode   String
  active    Boolean  @default(true)
  deleted   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  fulfillmentWarehouseId Int?
  fulfillmentWarehouse    WareHouse?   @relation("WarehouseSelfRelation", fields: [fulfillmentWarehouseId], references: [id])
  fulfilledWarehouses     WareHouse[]  @relation("WarehouseSelfRelation")
}

model WarehouseTransfer {
  id             Int       @id @default(autoincrement())
  productId      String
  variationId    String?
  productName    String
  variationName  String?
  price          String
  MRP            String
  FNSKU          String
  entries        Json
  image          String?
  sku            String?
  status         String    @default("pending")
  active         Boolean   @default(true)
  deleted        Boolean   @default(false)

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}


model WarehouseDispatch {
  id        Int      @id @default(autoincrement())
  entries   Json      
  totalUnits Int
  totalFNSKU Int
  status    String   @default("pending")
  active    Boolean  @default(true)
  deleted   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  dimensions       Json?   
  trackingId       String?  
  trackingLink     String? 
  shippingId       String? 
}


model DelhiWarehouseStock {
  id            Int      @id @default(autoincrement())
  dispatchId    Int
  productId     String
  variationId   String
  warehouseId   Int
  stock         Int
  shippingId    String
  trackingId    String?
  trackingLink  String?
  status        String   @default("accepted")
  active        Boolean  @default(true)
  deleted       Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([dispatchId, productId, variationId])
}




model ChatMessage {
  id          Int      @id @default(autoincrement())
  orderId     Int
  senderId    Int      // user id
  senderRole  String
  receiverId  Int
  receiverRole String
  text        String
  deleted     Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


model Banner {
  id         Int      @id @default(autoincrement())
  text       String?
  image      String?
  platform   String[] // ["XPRESS", "WEBSITE"]
  active     Boolean  @default(true)
  deleted    Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  countries  BannerCountry[]
  states     BannerState[]
}

model BannerCountry {
  id        Int    @id @default(autoincrement())
  bannerId  Int
  countryCode String // "IND", "USA"
  position  Int      // number/order

  banner Banner @relation(fields: [bannerId], references: [id], onDelete: Cascade)

  @@unique([bannerId, countryCode])
}

model BannerState {
  id        Int @id @default(autoincrement())
  bannerId  Int
  stateId   Int
  position  Int

  banner Banner @relation(fields: [bannerId], references: [id], onDelete: Cascade)
  state  State  @relation(fields: [stateId], references: [id])

  @@unique([bannerId, stateId])
}


model PromoCode {
  id              Int      @id @default(autoincrement())
  code            String   @unique
  discountType    PromoDiscountType
  discountValue   Float

  validFrom       DateTime
  validTill       DateTime

  usageLimit      Int?     // null = unlimited
  usedCount       Int      @default(0)

  appliesTo       PromoAppliesTo // ALL_USERS | SPECIFIC_USERS
  active          Boolean  @default(true)
  deleted         Boolean  @default(false)

  eligibleUsers      Json?    // ðŸ”¥ SPECIFIC_USERS ke liye

  users           PromoUser[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}


model PromoUser {
  id        Int @id @default(autoincrement())

  promoId   Int
  userId    Int
  orderId   Int  

  usedCount Int @default(1) 
  subtotal      Float? 
  discountAmount Float? 

  createdAt      DateTime @default(now()) 
  updatedAt      DateTime? @updatedAt       


  promo     PromoCode @relation(fields: [promoId], references: [id])

  @@unique([promoId, orderId]) // ðŸ”¥ SAME ORDER ME SAME PROMO 2 BAAR NA LAGE
}




model DonationCampaign {
  id          Int              @id @default(autoincrement())
  title       String
  description String
  amounts        Float[]
  active        Boolean          @default(true) 
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  userDonations UserDonation[] // relation to track who donated
}

model UserDonation {
  id                 Int              @id @default(autoincrement())
  userName           String
  userId             Int? 
  orderId            Int?             // âœ… Added orderId
  amount             Float
  donatedAt          DateTime         @default(now())
  
  donationCampaignId Int
  donationCampaign   DonationCampaign @relation(fields: [donationCampaignId], references: [id])
}


model Reviews {
  id        Int      @id @default(autoincrement())

  userId    Int
  userName  String

  productId String?  // ðŸ‘ˆ OPTIONAL for now

  comment   String
  rating    Int

  status    String   @default("pending")
  active    Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model BangaloreIncreffOrder {
  id               Int      @id @default(autoincrement())
  dispatchId       Int
  orderCode        String
  locationCode     String
  payload          Json
  response         Json
  createdAt        DateTime @default(now())
}

model Duration {
  id          Int      @id @default(autoincrement())

  minutes     Int      // 15, 30, 60, ya custom minutes
  description String?  // optional description

  active      Boolean  @default(true)
  deleted     Boolean  @default(false)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  servicePrices ServiceDuration[]
}


model Service {
  id          Int                  @id @default(autoincrement())
  title       String
  shortDesc   String?              // optional short description
  longDesc    String?              // optional long description
  image       String?              // URL of the service image
  active      Boolean              @default(true)
  deleted     Boolean              @default(false)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  // Relation to prices per duration
  prices      ServiceDuration[]    // one-to-many relation
}

model ServiceDuration {
  id         Int       @id @default(autoincrement())
  service    Service   @relation(fields: [serviceId], references: [id])
  serviceId  Int
  duration   Duration  @relation(fields: [durationId], references: [id])
  durationId Int
  price      Float     // price for this service for this duration
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}


model Astrologer {
  id           Int                 @id @default(autoincrement())
  userId       Int?                // optional link to a User
  fullName     String
  displayName  String?
  phone        String?
  service      String?             // Service assigned
  specialty    String?             // Specialty assigned
  description  String?
  profileImage String?
  active       Boolean             @default(true)
  deleted      Boolean             @default(false)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  documents    AstrologerDocument[]
}

model AstrologerDocument {
  id           Int         @id @default(autoincrement())
  astrologer   Astrologer  @relation(fields: [astrologerId], references: [id])
  astrologerId Int
  fileUrl      String
  createdAt    DateTime    @default(now())
}


model Blog {
  id           Int      @id @default(autoincrement())

  title        String
  slug         String   @unique

  authorName   String
  authorImage  String?

  category     String

  description  String   @db.Text
  excerpt      String?  @db.Text

  image        String?
  readTime     Int? 

  isPublished  Boolean  @default(false)
  active       Boolean  @default(true)
  deleted      Boolean  @default(false)

  views        Int      @default(0)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}


model BlogReviews {
  id        Int      @id @default(autoincrement())

  userId    Int
  userName  String

  blogId    Int

  comment   String
  rating    Int

  status    ReviewStatusBlog @default(pending)
  active    Boolean      @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, blogId])
}

model PasswordReset {
  id        Int      @id @default(autoincrement())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())
}

model order_adjustments {
  id              Int        @id @default(autoincrement())

  orderId         Int
  order           Orders     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  adjustmentType  AdjustmentType
  impact          AdjustmentImpact

  amount          Decimal    @db.Decimal(12, 2)

  reason          String?    @db.VarChar(255)

  status          AdjustmentStatus @default(PENDING)

  paymentTxnId    String?    @unique
  paidAt          DateTime?

  isManual        Boolean   @default(false)
  manualType      String?   @db.VarChar(200)
  expiresAt       DateTime?

  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

}
